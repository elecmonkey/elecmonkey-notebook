# 第1章 计算机网络与互联网

## 1.1 互联网是什么：基础设施与服务视角
### 1.1.1 “螺母与螺栓”视角（nuts and bolts）
互联网（Internet）从工程角度看是由大量硬件与软件组件构成的基础设施：
- 端系统（end systems）/主机（hosts）：运行应用程序，是网络“边缘”（edge）部分的主体。
- 分组交换设备（packet switches）：路由器（router）与交换机（switch）负责在网络核心转发分组（packet）。
- 通信链路（communication links）：铜缆（copper）、光纤（fiber）、无线电（radio）、卫星（satellite）等媒介。
- 传输速率（transmission rate）/带宽（bandwidth）：链路单位时间内传输比特的能力，通常以 bps 表示。
- 协议（protocol）：用于控制发送与接收消息的规则集合。

这类视角强调“互联网是一套设备+协议的组合”，非常适合从工程实现角度理解网络。

### 1.1.2 服务视角（services）
互联网也可以被视作“提供服务的基础设施”（a networking infrastructure）：
- 为应用提供通信服务：Web、流媒体（streaming video）、电子邮件（email）、社交网络、在线游戏、电子商务等。
- 为应用提供编程接口（API）：应用不需要关心复杂的网络细节，只需调用传输服务即可进行数据发送与接收。

### 1.1.3 互联网是“网络的网络”（network of networks）
互联网由大量自治网络（ISP、企业网、校园网、内容提供商网络、数据中心网络等）互联组成。不同组织管理的网络通过协议标准互通，形成全球范围的“网络的网络”。

## 1.2 协议与协议设计
### 1.2.1 协议的三要素
协议（protocol）定义网络实体之间如何通信，包含三要素：
- 语法（syntax）：消息格式、字段位置与长度。
- 语义（semantics）：字段含义与应采取的动作。
- 时序（timing）：消息发送顺序与时间要求。

### 1.2.2 协议的作用
没有协议就无法互通。HTTP 定义了网页请求与响应格式，TCP 规定可靠传输机制，IP 规定寻址与路由方式，WiFi 与以太网规定链路访问规则。协议让“不同厂商、不同设备”可以相互理解。

### 1.2.3 协议设计的基本思路
- 先明确需求：是否需要可靠性、实时性、可扩展性？
- 再选择机制：握手、序号、确认、重传、拥塞控制等。
- 协议必须兼顾：性能、复杂度、兼容性与可部署性。

## 1.3 网络边缘：主机与接入网络
### 1.3.1 主机类型与角色
- 客户端（client）：发起请求，如浏览器。
- 服务器（server）：提供服务，如 Web 服务器。
主机位于网络边缘，通过接入网络连接到核心路由器。

### 1.3.2 住宅接入网络
#### 1.3.2.1 HFC（Hybrid Fiber Coax）
混合光纤同轴（HFC）使用光纤连接到小区，再用同轴电缆分配到家庭。
- 频分复用（FDM）：数据、语音、视频占用不同频段。
- 下行带宽通常更高，上行较低，体现非对称（asymmetric）特性。

#### 1.3.2.2 ADSL（Asymmetric Digital Subscriber Line）
利用既有电话线：
- DSLAM 集中接入数据，语音仍进入电话网。
- 下行速率高于上行，适合“下载多、上传少”的家庭场景。

#### 1.3.2.3 FTTH（Fiber To The Home）
光纤直接到户，带宽高、时延低。
- 可采用波分复用（WDM, Wavelength Division Multiplexing）。

### 1.3.3 机构接入与数据中心
- 校园/企业网络：以太网（Ethernet）与 WiFi 为主。
- 数据中心网络：高带宽（10–100 Gbps）连接大量服务器。

### 1.3.4 移动蜂窝接入
广域蜂窝网络（4G/5G）覆盖范围大，由运营商部署基站并接入核心网。

### 1.3.5 家庭网络示例
典型家庭路由器集成：
- 调制解调器（modem）
- 路由器（router）
- NAT、DHCP、防火墙（firewall）
- 无线接入点（AP）

## 1.4 物理媒体：有线与无线
### 1.4.1 有线介质（guided media）
#### 1.4.1.1 双绞线（twisted pair）
两根绝缘铜线绞合，减少电磁干扰与串扰（crosstalk）。

#### 1.4.1.2 同轴电缆（coaxial cable）
内导体+绝缘层+屏蔽层，抗干扰强、成本低。

#### 1.4.1.3 光纤（fiber optic）
光脉冲传输比特：高带宽、低误码率、抗电磁干扰，但成本较高。

### 1.4.2 无线介质（unguided media）
无线电（radio）通过电磁波传播：
- 广播式传输（broadcast）
- 易受反射、遮挡与噪声干扰

## 1.5 网络核心：电路交换与分组交换
### 1.5.1 网络核心功能
由路由器构成网络核心，负责分组转发与路径选择。

### 1.5.2 电路交换（circuit switching）
通信前建立专用链路并预留资源：
- 建立电路 → 数据传输 → 拆除电路
- 复用方式：FDM（频分复用）、TDM（时分复用）
- 优点：带宽可预测，适合稳定会话；缺点：资源利用率低

### 1.5.3 分组交换（packet switching）
报文拆分为分组逐个发送：
- 存储转发（store-and-forward）：完整分组到达才转发
- 统计复用（statistical multiplexing）：按需共享资源
- 优点：资源利用率高；缺点：排队与丢包

### 1.5.4 转发与路由
- 转发（forwarding）：路由器局部动作，根据转发表将分组送到输出端口。
- 路由（routing）：全局动作，决定路径。

## 1.6 分组时延、丢包与吞吐量
### 1.6.1 四种节点时延
节点时延（nodal delay）：
- 处理时延（processing, dproc）
- 排队时延（queueing, dqueue）
- 传输时延（transmission, dtrans）
- 传播时延（propagation, dprop）
总时延：dnodal = dproc + dqueue + dtrans + dprop

### 1.6.2 传输时延与传播时延区别
- 传输时延：dtrans = L / R（L 为分组长度，R 为链路速率）
- 传播时延：dprop = d / s（d 为链路长度，s 为传播速率）

### 1.6.3 流量强度
流量强度（traffic intensity）：La/R
- 接近 1 时排队时延显著增大
- 超过 1 时队列不稳定，平均时延趋于无穷

### 1.6.4 丢包（packet loss）
队列缓冲有限，分组到达过快时溢出丢包，需要上层重传或处理。

### 1.6.5 端到端时延
若有 n-1 个路由器且无拥塞：
end-to-end delay = n * (dproc + dtrans + dprop)

### 1.6.6 吞吐量（throughput）
- 瞬时吞吐量（instantaneous）
- 平均吞吐量（average）
瓶颈链路决定端到端吞吐量。

### 1.6.7 traceroute 与时延测量
traceroute（Linux）/tracert（Windows）利用 TTL 逐跳测量时延。

## 1.7 分层模型与服务关系
### 1.7.1 分层思想
分层提供模块化：
- 每层为上一层提供服务
- 下层变化对上层透明

### 1.7.2 OSI 七层模型
应用层、表示层、会话层、传输层、网络层、数据链路层、物理层。

### 1.7.3 TCP/IP 与五层模型
五层模型：应用、传输、网络、数据链路、物理。

### 1.7.4 协议与服务
- 协议：同层实体间规则
- 服务：下层向上层提供能力

### 1.7.5 封装与 PDU
数据自上而下封装为：报文、报文段、数据报、帧、比特流。

## 1.8 数据通信基础：信号、调制、编码与容量
### 1.8.1 信号与码元
- 模拟信号（analog）：连续
- 数字信号（digital）：离散
- 码元（symbol）：固定时长波形，可能携带多个比特
- 波特率（baud）：码元传输速率

### 1.8.2 信道与通信方式
- 单工、半双工、全双工
- 带宽（bandwidth）：可通过的频带宽度或数据量

### 1.8.3 基带调制与带通调制
- 基带调制（coding）：NRZ、RZ、Manchester、差分 Manchester
- 带通调制（carrier）：AM、FM、PM

### 1.8.4 奈氏准则与香农公式
奈氏（Nyquist）：理想低通信道最大码元速率 = 2W
香农（Shannon）：C = W log2(1 + S/N)
带宽或信噪比越大，容量越高。

## 1.9 互联网发展简史
### 1.9.1 1960s–1970s
- 分组交换思想（Kleinrock、Baran）
- ARPAnet 1969 上线

### 1.9.2 1970s–1980s
- ALOHA、Ethernet
- Cerf 与 Kahn 提出互联网络架构

### 1.9.3 1980s–1990s
- TCP/IP 部署
- DNS、SMTP、FTP 等协议出现

### 1.9.4 1990s–2000s
- Web 兴起（HTML/HTTP）
- 商业化与浏览器普及

### 1.9.5 2005 至今
- 宽带、4G/5G
- 云计算与大型服务提供商自建网络
- 智能手机推动移动互联网
