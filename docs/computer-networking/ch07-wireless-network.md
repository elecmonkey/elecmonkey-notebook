# 第7章 无线网络

## 7.1 无线网络基本组成
### 7.1.1 无线主机（wireless hosts）
无线主机包括笔记本电脑、手机、平板、物联网终端等。
无线并不一定意味着移动，固定无线终端依然属于无线主机。
无线主机运行应用层程序，与有线主机一样需要传输层和网络层支持。

### 7.1.2 无线链路（wireless link）
无线链路用于连接无线主机与基站，也可作为无线回程链路。
无线链路通常是共享介质，需要多路访问协议协调发送。
无线链路的数据速率与传输距离存在权衡：速率越高，覆盖范围通常越小。

### 7.1.3 基站（base station）
基站负责在无线主机与有线网络之间中继分组。
常见基站包括蜂窝基站和 WiFi 接入点（AP, Access Point）。
基站通常连接有线网络，并维护与多个无线主机的无线连接。

### 7.1.4 基础设施模式（infrastructure mode）
无线主机通过基站接入有线网络。
移动主机在基站之间移动时发生切换（handoff）。
切换需要保持连接连续性与 IP 可达性，可能引入短暂中断。

### 7.1.5 自组织模式（ad hoc mode）
没有基站，节点直接通信。
节点只与覆盖范围内的邻居通信，需要自行形成路由。
自组织网络在救灾、军用通信、无人机协同等场景常见。

### 7.1.6 无线网络分类（taxonomy）
单跳、连接互联网：WiFi、蜂窝（cellular）。
单跳、无互联网：蓝牙（Bluetooth）等近距离网络。
多跳、连接互联网：Mesh 网络，需要中继节点转发。
多跳、无互联网：MANET、VANET 等移动自组网。

## 7.2 无线链路特性
### 7.2.1 路径损耗（path loss）
无线信号随距离衰减，路径损耗显著影响可用速率与范围。
路径损耗还受障碍物、墙体、地形等环境因素影响。

### 7.2.2 干扰（interference）
无线频谱是共享资源，多设备同时工作会相互干扰。
常见干扰源包括 WiFi、蓝牙、微波炉、电机等设备。
干扰会导致误码率上升、吞吐量下降与时延增大。

### 7.2.3 多径传播（multipath propagation）
信号在墙壁、地面等物体上反射，形成多条传播路径。
多路径导致接收端信号在不同时间到达，出现时延扩展。
多径可能引起信号叠加与衰落，影响可靠性。

### 7.2.4 无线链路的“不稳定性”
无线链路比有线链路更“难以预测”。
信号强度会随位置、遮挡、天气等因素波动。
因此无线协议更强调适应性与鲁棒性。

## 7.3 隐藏终端与暴露终端
### 7.3.1 隐藏终端（hidden terminal）问题
A 与 C 互相听不到对方，但都能听到 B。
A 与 C 同时发送时会在 B 处碰撞。
由于 A 与 C 彼此感知不到，无法通过载波侦听避免碰撞。
隐藏终端导致碰撞概率上升，吞吐量下降。

### 7.3.2 暴露终端（exposed terminal）问题
A 发送到 C 时，B 能听到 A，因此误以为信道忙。
但 B 向 D 的发送不会与 A→C 冲突。
由于过度保守，B 被迫等待，导致信道资源浪费。

### 7.3.3 与 CSMA 的关系
隐藏终端使 CSMA“听前发送”失效。
暴露终端使 CSMA 过度保守。
因此无线需要在 CSMA 基础上加入额外机制。

## 7.4 IEEE 802.11 无线局域网
### 7.4.1 802.11 标准族概览
802.11b：2.4 GHz，最高 11 Mbps。
802.11g：2.4 GHz，最高 54 Mbps。
802.11n（WiFi 4）：2.4/5 GHz，最高 600 Mbps。
802.11ac（WiFi 5）：5 GHz，最高数 Gbps。
802.11ax（WiFi 6）：2.4/5 GHz，最高十余 Gbps。
802.11af：利用电视空白频段（54–790 MHz）。
802.11ah：900 MHz，远距离低功耗场景。

### 7.4.2 共同特性
所有 802.11 标准都使用 CSMA/CA 进行多路访问。
既支持基础设施模式，也支持 ad hoc 模式。
标准差异主要在频段、速率、调制技术与覆盖范围。

### 7.4.3 802.11 网络架构
基础设施模式中，AP 负责协调无线主机接入。
基本服务集（BSS, Basic Service Set）即一个 AP 与其覆盖范围内的主机。
多个 BSS 可通过有线网络互联形成扩展服务集（ESS）。

## 7.5 802.11 频谱、信道与关联
### 7.5.1 信道划分
以 802.11b 为例，2.4 GHz–2.485 GHz 划分为 11 个信道。
相邻信道存在频率重叠，可能产生干扰。

### 7.5.2 信道选择与干扰
AP 管理员选择工作信道。
相邻 AP 如果使用相同信道，会造成同频干扰。
合理的信道规划可显著提高性能。

### 7.5.3 关联（association）过程
无线主机需要关联到一个 AP 才能接入网络。
主机通过扫描（scanning）发现 AP 的 SSID 与 MAC 地址。
扫描后选择 AP 并发送关联请求。
关联成功后，主机会进入该 AP 的子网。

### 7.5.4 被动扫描（passive scanning）
AP 周期性广播 beacon 帧。
主机监听 beacon，获取 SSID 与 AP 信息。
主机选择 AP 并发送 association request。
AP 返回 association response。

### 7.5.5 主动扫描（active scanning）
主机广播 probe request。
AP 发送 probe response。
主机选择 AP 并完成关联。
主动扫描速度快，但会增加广播开销。

### 7.5.6 关联后的地址配置
关联完成后，主机通常运行 DHCP 获取 IP 地址。
DHCP 在无线网络中仍基于 UDP/IP/链路层封装。

## 7.6 802.11 多路访问与 CSMA/CA
### 7.6.1 无碰撞检测的原因
无线发送信号强，接收信号弱，难以检测碰撞。
信道衰落与隐藏终端进一步使碰撞检测失效。
因此 802.11 采用“碰撞避免”（Collision Avoidance）。

### 7.6.2 CSMA/CA 基本思想
先监听信道是否空闲。
若空闲，等待 DIFS（Distributed Inter-Frame Space）。
若忙，进入随机退避（backoff）计时。
计时在信道空闲时递减，忙时冻结。
计时归零后发送帧。

### 7.6.3 ACK 机制
接收端成功接收数据帧后，在 SIFS 后发送 ACK。
发送端若未收到 ACK，会认为碰撞或丢包并重传。
ACK 为短帧，减少额外开销。

### 7.6.4 退避窗口调整
若连续失败，退避窗口会增大。
退避窗口增大可降低冲突概率，但增加延迟。

### 7.6.5 CSMA/CA 与 CSMA/CD 的对比
CSMA/CD 通过检测碰撞并停止发送。
CSMA/CA 通过避免碰撞并依赖 ACK 反馈。
无线环境下 CSMA/CD 不可行，因此必须采用 CA。

## 7.7 RTS/CTS 机制
### 7.7.1 设计动机
RTS/CTS 用于缓解隐藏终端问题。
通过短控制帧先“预约”信道。

### 7.7.2 交互流程
发送端先发送 RTS（Request To Send）。
接收端若可接收则回复 CTS（Clear To Send）。
其他站点听到 CTS 后退避。
发送端发送数据帧。
接收端发送 ACK。

### 7.7.3 作用与代价
RTS/CTS 能降低碰撞，但会增加控制开销。
通常仅在大帧或高冲突环境启用。

## 7.8 802.11 帧结构
### 7.8.1 帧控制字段
帧控制字段包含类型、子类型、更多标志位。
不同类型帧包括数据帧、控制帧、管理帧。

### 7.8.2 地址字段
802.11 帧最多有 4 个地址字段：
Address 1：接收方 MAC。
Address 2：发送方 MAC。
Address 3：与 AP 相连路由器接口的 MAC。
Address 4：仅 ad hoc 模式使用。

### 7.8.3 其他字段
持续时间（duration）字段用于网络分配向量（NAV）。
序号控制（sequence control）用于重组与去重。
负载（payload）携带上层数据。
CRC 用于差错检测。

## 7.9 无线网络的性能与可用性
### 7.9.1 影响性能的因素
信号强度、干扰、用户数量、信道选择都会影响吞吐量。
传输速率与覆盖范围之间存在权衡。

### 7.9.2 速率自适应（rate adaptation）
无线设备会根据链路质量动态调整速率。
链路好时使用高阶调制，链路差时降低速率以提高可靠性。

### 7.9.3 时延与抖动
无线链路的时延与抖动更明显。
实时业务（语音、视频会议）对无线环境更敏感。

## 7.10 无线安全基础（补充）
### 7.10.1 开放式与加密式
开放式 WiFi 无加密，数据易被监听。
加密式 WiFi 使用密码与加密协议。

### 7.10.2 WEP 与 WPA
WEP 已不安全，容易被破解。
WPA/WPA2/WPA3 提供更强加密与认证机制。

### 7.10.3 安全实践
使用强密码，避免开放网络传输敏感信息。
企业网络常配合 802.1X 认证与证书体系。

## 7.11 无线网络与移动性（补充）
### 7.11.1 切换（handoff）
移动主机在不同 AP 之间切换时，可能短暂中断。
切换速度与体验密切相关。

### 7.11.2 移动性对 IP 的影响
切换后 IP 可能变化，影响会话连续性。
移动 IP（Mobile IP）等机制可减轻影响。

### 7.11.3 实际应用场景
城市地铁、商场、校园等高密度场景对无线网络提出更高要求。
需要更好的信道规划与负载均衡策略。

## 7.12 本章小结
无线网络由无线主机、无线链路与基站组成。
无线链路面临路径损耗、干扰、多径等挑战。
隐藏终端与暴露终端导致 CSMA 失效。
802.11 采用 CSMA/CA 与 RTS/CTS 机制。
关联与扫描过程决定无线主机如何接入网络。
无线性能受信道、干扰、用户数量影响明显。

## 7.13 关键术语速览（补充）
### 7.13.1 术语对照
BSS（Basic Service Set）：AP 与其覆盖范围内主机集合。
ESS（Extended Service Set）：多个 BSS 通过有线网络互联形成。
SSID（Service Set Identifier）：无线网络名称。
RSSI（Received Signal Strength Indicator）：接收信号强度指标。
NAV（Network Allocation Vector）：虚拟载波侦听计时。
DIFS（Distributed Inter-Frame Space）：分布式帧间间隔。
SIFS（Short Inter-Frame Space）：短帧间间隔。
RTS/CTS：请求发送/允许发送控制帧。

### 7.13.2 常见数值
2.4 GHz 频段可用信道少、干扰大。
5 GHz 频段信道多、干扰相对小。
802.11 帧负载最大 2312 字节（取决于标准与配置）。

## 7.14 802.11 与以太网对比（补充）
### 7.14.1 介质不同
以太网：有线介质，信号稳定。
802.11：无线介质，信道波动大。

### 7.14.2 冲突处理不同
以太网使用 CSMA/CD，能检测冲突。
802.11 使用 CSMA/CA，通过避免冲突与 ACK 反馈。

### 7.14.3 时延与吞吐量
以太网通常更稳定、更高吞吐。
无线链路吞吐量与环境关系更大。

## 7.15 隐藏终端与暴露终端的直观理解（补充）
### 7.15.1 隐藏终端类比
两个人在不同房间向同一窗口说话。
他们听不到彼此，但窗口处会发生“冲突”。

### 7.15.2 暴露终端类比
一个人听到隔壁说话就不敢开口。
实际上对方并不会影响他的接收者。

## 7.16 无线链路设计中的权衡（补充）
### 7.16.1 速率与距离
速率越高，调制越复杂，对信道质量要求越高。
距离越远，信号衰减越大，需要降低速率。

### 7.16.2 可靠性与效率
更强纠错提高可靠性，但降低有效吞吐量。
更大退避窗口降低冲突，但增加等待时间。

### 7.16.3 能耗与性能
移动设备需要节能，可能牺牲性能。
低功耗协议（如 802.11ah）为物联网设计。

## 7.17 802.11 帧类型补充
### 7.17.1 管理帧（management frame）
用于扫描、关联、认证等过程。
典型管理帧包括 beacon、probe request/response。

### 7.17.2 控制帧（control frame）
用于信道控制与确认。
典型控制帧包括 RTS、CTS、ACK。

### 7.17.3 数据帧（data frame）
携带上层数据负载，是用户实际通信内容。

## 7.18 WiFi 连接质量影响因素（补充）
### 7.18.1 信号覆盖
AP 的功率与位置决定覆盖范围。
墙体、金属、玻璃会削弱信号。

### 7.18.2 同频干扰
邻居 AP 使用相同信道会相互干扰。
合理的信道规划可以减少冲突。

### 7.18.3 终端数量
一个 AP 同时服务的终端越多，平均吞吐越低。
热点环境需要更多 AP 分担负载。

## 7.19 802.11 安全与认证（补充）
### 7.19.1 开放式网络风险
开放 WiFi 易被窃听与中间人攻击。

### 7.19.2 常见认证方式
个人网络：预共享密钥（PSK）。
企业网络：802.1X + RADIUS 认证。

### 7.19.3 认证与加密的关系
认证确认身份，加密保护数据。
二者缺一不可。

## 7.20 实际应用建议（补充）
### 7.20.1 家庭网络
选择 5 GHz 频段可降低干扰。
路由器放置在开阔位置以提高覆盖。

### 7.20.2 企业网络
使用多 AP 覆盖与漫游优化。
配置合理 VLAN 隔离办公与访客流量。

### 7.20.3 公共网络
不建议传输敏感信息。
应使用 HTTPS 或 VPN 保护数据。
