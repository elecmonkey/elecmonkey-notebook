# 第八章 假设检验

## 8.1 假设检验的基本概念

### 8.1.1 假设检验的原理与基本理念

**假设检验**（Hypothesis Testing）是数理统计推断的另一个重要分支，它根据样本信息来判断关于总体的某个假设是否正确。

**基本思想**：
假设检验采用"反证法"的思想，即先假设要检验的假设是正确的，然后根据样本信息计算在此假设下某个统计量的观测值，如果这个观测值出现的概率很小（小于预先给定的显著性水平），就拒绝原假设；否则不拒绝原假设。

**例子**：
- 某厂声称其生产的零件的平均重量为100g，质检部门要检验这个声称是否属实；
- 医学研究中要检验某种新药是否比现有药物更有效；
- 教育研究中要检验某种新的教学方法是否能提高学生成绩。

**假设**：
1. **原假设**（零假设）$H_0$：通常是我们要检验的假设，一般表示"无显著差异"、"无显著效果"等；
2. **备择假设**（对立假设）$H_1$：与原假设相对立的假设。

假设检验的实质是在$H_0$和$H_1$之间选择其一。

### 8.1.2 假设检验的步骤

假设检验的基本步骤如下：

**第1步：建立假设**
根据实际问题的需要，建立原假设$H_0$和备择假设$H_1$。

**第2步：选择检验统计量**
根据样本信息和原假设，选择合适的检验统计量，并确定其在原假设成立时的分布。

**第3步：确定显著性水平**
显著性水平$\alpha$是一个很小的正数（如0.05、0.01等），表示在原假设成立的条件下，拒绝原假设的概率上界。

**第4步：确定拒绝域**
根据显著性水平$\alpha$和检验统计量的分布，确定拒绝域$W$，使得：
$$P(\text{检验统计量} \in W | H_0\text{成立}) = \alpha$$

**第5步：计算检验统计量的观测值**
根据样本数据计算检验统计量的观测值。

**第6步：作出检验结论**
- 若检验统计量的观测值落在拒绝域内，则拒绝$H_0$，接受$H_1$；
- 若检验统计量的观测值不在拒绝域内，则不拒绝$H_0$。

**检验的类型**：

1. **双侧检验**：$H_0: \theta = \theta_0$ vs $H_1: \theta \neq \theta_0$
2. **左侧检验**：$H_0: \theta \geq \theta_0$ vs $H_1: \theta < \theta_0$
3. **右侧检验**：$H_0: \theta \leq \theta_0$ vs $H_1: \theta > \theta_0$

### 8.1.3 假设检验中的两类错误

在假设检验中，可能犯两类错误：

**第一类错误**（Type I Error）：$H_0$为真，但被拒绝了。
- 概率：$P(\text{拒绝}H_0 | H_0\text{为真}) = \alpha$
- $\alpha$称为犯第一类错误的概率，也称为显著性水平

**第二类错误**（Type II Error）：$H_0$为假，但未被拒绝。
- 概率：$P(\text{不拒绝}H_0 | H_0\text{为假}) = \beta$
- $\beta$称为犯第二类错误的概率

**检验功效**：$1 - \beta = P(\text{拒绝}H_0 | H_0\text{为假})$，表示当$H_0$为假时正确拒绝$H_0$的概率。

|  | $H_0$为真 | $H_0$为假 |
|:---:|:---:|:---:|
| 不拒绝$H_0$ | 正确决策 | 第二类错误$(\beta)$ |
| 拒绝$H_0$ | 第一类错误$(\alpha)$ | 正确决策$(1-\beta)$ |

**理想目标**：希望$\alpha$和$\beta$都很小，但在样本容量固定的情况下，$\alpha$减小时$\beta$会增大，反之亦然。

**Neyman-Pearson原则**：在控制第一类错误概率不超过$\alpha$的前提下，尽可能使第二类错误概率$\beta$最小。

**p值**（p-value）：在原假设成立的条件下，检验统计量取观测值或更极端值的概率。若$p < \alpha$，则拒绝$H_0$；否则不拒绝$H_0$。

## 8.2 单个正态总体参数的假设检验

设$X_1, X_2, \ldots, X_n$是来自正态总体$N(\mu, \sigma^2)$的简单随机样本，$\overline{X}$和$S^2$分别是样本均值和样本方差。

### 8.2.1 均值$\mu$的检验

#### 情况1：$\sigma^2$已知

**检验问题**：
$$H_0: \mu = \mu_0 \quad \text{vs} \quad H_1: \mu \neq \mu_0 \text{ (双侧检验)}$$

**检验统计量**：
$$Z = \frac{\overline{X} - \mu_0}{\sigma/\sqrt{n}} \sim N(0,1) \quad (\text{当}H_0\text{成立时})$$

**拒绝域**：
对于显著性水平$\alpha$，拒绝域为：
$$W = \{|Z| > z_{\alpha/2}\}$$

**检验过程**：
1. 计算检验统计量：$z = \frac{\overline{x} - \mu_0}{\sigma/\sqrt{n}}$
2. 若$|z| > z_{\alpha/2}$，则拒绝$H_0$；否则不拒绝$H_0$

**单侧检验**：

左侧检验：$H_0: \mu \geq \mu_0$ vs $H_1: \mu < \mu_0$
- 拒绝域：$W = \{Z < -z_\alpha\}$

右侧检验：$H_0: \mu \leq \mu_0$ vs $H_1: \mu > \mu_0$
- 拒绝域：$W = \{Z > z_\alpha\}$

#### 情况2：$\sigma^2$未知

**检验问题**：
$$H_0: \mu = \mu_0 \quad \text{vs} \quad H_1: \mu \neq \mu_0$$

**检验统计量**：
$$T = \frac{\overline{X} - \mu_0}{S/\sqrt{n}} \sim t(n-1) \quad (\text{当}H_0\text{成立时})$$

**拒绝域**：
$$W = \{|T| > t_{\alpha/2}(n-1)\}$$

**检验过程**：
1. 计算检验统计量：$t = \frac{\overline{x} - \mu_0}{s/\sqrt{n}}$
2. 若$|t| > t_{\alpha/2}(n-1)$，则拒绝$H_0$；否则不拒绝$H_0$

**单侧检验的拒绝域**：
- 左侧检验：$W = \{T < -t_\alpha(n-1)\}$
- 右侧检验：$W = \{T > t_\alpha(n-1)\}$

### 8.2.2 方差$\sigma^2$的检验

#### 情况：$\mu$未知

**检验问题**：
$$H_0: \sigma^2 = \sigma_0^2 \quad \text{vs} \quad H_1: \sigma^2 \neq \sigma_0^2$$

**检验统计量**：
$$\chi^2 = \frac{(n-1)S^2}{\sigma_0^2} \sim \chi^2(n-1) \quad (\text{当}H_0\text{成立时})$$

**拒绝域**：
$$W = \left\{\chi^2 < \chi_{1-\alpha/2}^2(n-1) \text{ 或 } \chi^2 > \chi_{\alpha/2}^2(n-1)\right\}$$

**单侧检验**：

左侧检验：$H_0: \sigma^2 \geq \sigma_0^2$ vs $H_1: \sigma^2 < \sigma_0^2$
- 拒绝域：$W = \left\{\chi^2 < \chi_{1-\alpha}^2(n-1)\right\}$

右侧检验：$H_0: \sigma^2 \leq \sigma_0^2$ vs $H_1: \sigma^2 > \sigma_0^2$
- 拒绝域：$W = \left\{\chi^2 > \chi_\alpha^2(n-1)\right\}$

## 8.3 两个正态总体参数的假设检验

设$X_1, X_2, \ldots, X_{n_1}$是来自$N(\mu_1, \sigma_1^2)$的样本，$Y_1, Y_2, \ldots, Y_{n_2}$是来自$N(\mu_2, \sigma_2^2)$的样本，且两个样本相互独立。

### 8.3.1 均值$\mu_1$，$\mu_2$的检验

#### 情况1：$\sigma_1^2$和$\sigma_2^2$已知

**检验问题**：
$$H_0: \mu_1 = \mu_2 \quad \text{vs} \quad H_1: \mu_1 \neq \mu_2$$

**检验统计量**：
$$Z = \frac{(\overline{X} - \overline{Y}) - (\mu_1 - \mu_2)}{\sqrt{\frac{\sigma_1^2}{n_1} + \frac{\sigma_2^2}{n_2}}} \sim N(0,1) \quad (\text{当}H_0\text{成立时})$$

在$H_0$成立时，$\mu_1 - \mu_2 = 0$，故：
$$Z = \frac{\overline{X} - \overline{Y}}{\sqrt{\frac{\sigma_1^2}{n_1} + \frac{\sigma_2^2}{n_2}}} \sim N(0,1)$$

**拒绝域**：
$$W = \{|Z| > z_{\alpha/2}\}$$

#### 情况2：$\sigma_1^2 = \sigma_2^2 = \sigma^2$未知

**检验问题**：
$$H_0: \mu_1 = \mu_2 \quad \text{vs} \quad H_1: \mu_1 \neq \mu_2$$

**检验统计量**：
使用合并样本方差：
$$S_w^2 = \frac{(n_1-1)S_1^2 + (n_2-1)S_2^2}{n_1 + n_2 - 2}$$

$$T = \frac{\overline{X} - \overline{Y}}{S_w\sqrt{\frac{1}{n_1} + \frac{1}{n_2}}} \sim t(n_1 + n_2 - 2) \quad (\text{当}H_0\text{成立时})$$

**拒绝域**：
$$W = \{|T| > t_{\alpha/2}(n_1 + n_2 - 2)\}$$

#### 情况3：$\sigma_1^2 \neq \sigma_2^2$且均未知（Welch检验）

**检验统计量**：
$$T = \frac{\overline{X} - \overline{Y}}{\sqrt{\frac{S_1^2}{n_1} + \frac{S_2^2}{n_2}}}$$

近似服从自由度为$\nu$的$t$分布，其中：
$$\nu = \frac{\left(\frac{S_1^2}{n_1} + \frac{S_2^2}{n_2}\right)^2}{\frac{(S_1^2/n_1)^2}{n_1-1} + \frac{(S_2^2/n_2)^2}{n_2-1}}$$

**拒绝域**：
$$W = \{|T| > t_{\alpha/2}(\nu)\}$$

#### 情况4：配对样本检验

当两个样本中的观测值存在自然配对关系时，设$D_i = X_i - Y_i, i = 1, 2, \ldots, n$，则问题转化为对$D_i$进行单样本$t$检验。

**检验问题**：
$$H_0: \mu_D = 0 \quad \text{vs} \quad H_1: \mu_D \neq 0$$

**检验统计量**：
$$T = \frac{\overline{D}}{S_D/\sqrt{n}} \sim t(n-1)$$

其中$\overline{D} = \frac{1}{n}\sum_{i=1}^{n}D_i$，$S_D^2 = \frac{1}{n-1}\sum_{i=1}^{n}(D_i - \overline{D})^2$。

### 8.3.2 方差$\sigma_1^2$，$\sigma_2^2$的检验

#### 检验两个方差是否相等

**检验问题**：
$$H_0: \sigma_1^2 = \sigma_2^2 \quad \text{vs} \quad H_1: \sigma_1^2 \neq \sigma_2^2$$

**检验统计量**：
$$F = \frac{S_1^2}{S_2^2} \sim F(n_1-1, n_2-1) \quad (\text{当}H_0\text{成立时})$$

**拒绝域**：
$$W = \left\{F < F_{1-\alpha/2}(n_1-1, n_2-1) \text{ 或 } F > F_{\alpha/2}(n_1-1, n_2-1)\right\}$$

由于$F_{1-\alpha/2}(n_1-1, n_2-1) = \frac{1}{F_{\alpha/2}(n_2-1, n_1-1)}$，拒绝域也可写成：
$$W = \left\{F < \frac{1}{F_{\alpha/2}(n_2-1, n_1-1)} \text{ 或 } F > F_{\alpha/2}(n_1-1, n_2-1)\right\}$$

**单侧检验**：

右侧检验：$H_0: \sigma_1^2 \leq \sigma_2^2$ vs $H_1: \sigma_1^2 > \sigma_2^2$
- 拒绝域：$W = \{F > F_\alpha(n_1-1, n_2-1)\}$

左侧检验：$H_0: \sigma_1^2 \geq \sigma_2^2$ vs $H_1: \sigma_1^2 < \sigma_2^2$
- 拒绝域：$W = \{F < F_{1-\alpha}(n_1-1, n_2-1)\}$

## 8.4 总体分布的$\chi^2$拟合优度检验

拟合优度检验用于检验样本是否来自某个特定的总体分布。

### 8.4.1 理论分布$F_0$完全已知的情况

**检验问题**：
$$H_0: \text{总体分布为}F_0(x) \quad \text{vs} \quad H_1: \text{总体分布不是}F_0(x)$$

**基本思想**：
将样本空间分成$k$个互不相交的区间$A_1, A_2, \ldots, A_k$，比较各区间内的实际频数与理论频数的差异。

**符号**：
- $n_i$：样本中落在区间$A_i$内的观测个数（实际频数）
- $p_i = P(X \in A_i)$：当$H_0$成立时，观测值落在$A_i$内的概率
- $np_i$：理论频数

**Pearson $\chi^2$统计量**：
$$\chi^2 = \sum_{i=1}^{k}\frac{(n_i - np_i)^2}{np_i}$$

**定理**：当$H_0$成立且$n \to \infty$时，若$np_i \geq 5$（$i = 1, 2, \ldots, k$），则：
$$\chi^2 \xrightarrow{d} \chi^2(k-1)$$

**拒绝域**：
$$W = \{\chi^2 > \chi_\alpha^2(k-1)\}$$

**检验步骤**：
1. 将样本空间分成$k$个区间，计算各区间的实际频数$n_i$；
2. 在$H_0$下计算各区间的理论概率$p_i$和理论频数$np_i$；
3. 检查是否满足$np_i \geq 5$，如不满足需合并相邻区间；
4. 计算检验统计量$\chi^2 = \sum_{i=1}^{k}\frac{(n_i - np_i)^2}{np_i}$；
5. 若$\chi^2 > \chi_\alpha^2(k-1)$，则拒绝$H_0$。

### 8.4.2 理论分布$F_0$含有未知参数的情况

当理论分布$F_0$含有$r$个未知参数时，需要先用样本估计这些参数。

**检验步骤**：
1. 用样本估计分布$F_0$中的$r$个未知参数；
2. 用估计参数替代真实参数，按8.4.1的方法进行检验；
3. 自由度改为$k-r-1$。

**定理**：当$H_0$成立、$n \to \infty$且参数用极大似然估计时，检验统计量渐近服从$\chi^2(k-r-1)$分布。

**拒绝域**：
$$W = \{\chi^2 > \chi_\alpha^2(k-r-1)\}$$

**常见应用**：

1. **检验正态性**：$H_0: X \sim N(\mu, \sigma^2)$
   - 用样本均值和样本方差估计$\mu$和$\sigma^2$
   - 自由度为$k-2-1 = k-3$

2. **检验泊松分布**：$H_0: X \sim P(\lambda)$
   - 用样本均值估计$\lambda$
   - 自由度为$k-1-1 = k-2$

3. **检验指数分布**：$H_0: X \sim Exp(\lambda)$
   - 用样本均值的倒数估计$\lambda$
   - 自由度为$k-1-1 = k-2$

**独立性检验**：
用于检验两个分类变量是否独立。设有$r \times c$列联表，其中$n_{ij}$表示第$i$行第$j$列的观测频数。

**检验问题**：
$$H_0: \text{行变量与列变量相互独立} \quad \text{vs} \quad H_1: \text{行变量与列变量不独立}$$

**检验统计量**：
$$\chi^2 = \sum_{i=1}^{r}\sum_{j=1}^{c}\frac{(n_{ij} - \hat{n}_{ij})^2}{\hat{n}_{ij}}$$

其中$\hat{n}_{ij} = \frac{n_{i\cdot}n_{\cdot j}}{n}$是理论频数，$n_{i\cdot} = \sum_{j=1}^{c}n_{ij}$，$n_{\cdot j} = \sum_{i=1}^{r}n_{ij}$，$n = \sum_{i=1}^{r}\sum_{j=1}^{c}n_{ij}$。

当$H_0$成立时，$\chi^2 \sim \chi^2((r-1)(c-1))$。

**拒绝域**：
$$W = \{\chi^2 > \chi_\alpha^2((r-1)(c-1))\}$$
